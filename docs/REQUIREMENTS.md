# REQUIREMENTS

## Background / KPI
- CLI/GUI で `fzf --walker` 相当の高速検索体験を提供する。
- `FileList.txt`（`filelist.txt` 含む）を既存資産として利用し、対象集合を明示的に管理できるようにする。
- KPI-001: 10万件規模の候補に対して、インデックス構築後の検索応答を 100ms 未満（目標）にする。
- KPI-002: Windows/macOS/Linux で同等の検索・オープン体験を提供する。

## Scope
### In
- Rust での CLI/GUI 実装。
- ファイル/フォルダの収集（walker / FileList 両対応）。
- fzf 互換クエリでの検索。
- 検索結果からの実行/オープン。
- SDD + TDD ドキュメントとテスト整備。

### Out
- 旧プロトタイプの機能追加。
- ネットワーク共有ドライブ最適化。
- 配布インストーラ作成。

## Use cases
- UC-001: 開発者がプロジェクト配下を横断検索し、目的ファイルを即時オープンする。
- UC-002: 利用者が `FileList.txt` に列挙した対象のみ検索し、実行可能ファイルを起動する。
- UC-003: 利用者が検索結果のフォルダを選択し、OS のファイルマネージャで開く。
- UC-004: 利用者が GUI で候補を確認しながら、複数選択して一括アクションを実行する。

## Requirements
### Functional (FR)
- FR-001: ツールは FileList 優先モード有効時、検索ルート直下の `FileList.txt` / `filelist.txt`（および `filelist.txt` の大文字小文字違い）を優先して候補集合を構築しなければならない。
- FR-002: ツールはリスト未存在時、walker 方式で再帰走査して候補を構築しなければならない。
- FR-003: ツールは fzf 互換クエリ（`'`、`!`、`^`、`$`）に基づく検索を提供し、関連度順で結果を返さなければならない。
- FR-004: ツールは選択対象がファイルの場合、実行可能なら実行し、非実行ファイルは既定アプリでオープンしなければならない。
- FR-005: ツールは選択対象がフォルダの場合、OS 既定の方法でオープンしなければならない。
- FR-006: ツールは CLI モード（`--cli`）で検索結果を表示し、GUI なしで利用可能でなければならない。
- FR-007: ツールは GUI モードで検索入力、結果リスト、プレビュー、複数選択、一括実行/オープンを提供しなければならない。

### Non-functional (NFR)
- NFR-001: 10万件候補での検索処理は 100ms 未満を目標（SHOULD）とする。
- NFR-002: 例外時はユーザ向けに原因を表示し、非ゼロ終了コードを返すこと。
- NFR-003: モジュールはテスト可能に分離され、主要機能に unit test を持つこと。
- NFR-004: GUI の主要フロー（検索、選択、アクション、再読込）は回帰手順を定義すること。

### Constraints (CON)
- CON-001: 本実装は Rust で行う。
- CON-002: 外部コマンド実行は配列引数で呼び出し、シェル展開依存を避ける。

## Acceptance Criteria
- AC-001: FileList 優先モード有効時、`FileList.txt` 系ファイルが存在すれば walker を使わず、列挙対象のみが候補になる。
- AC-002: `FileList.txt`、`filelist.txt`、および `filelist.txt` の大文字小文字違いで同等に動作する。
- AC-003: クエリ入力で関連度順の上位 N 件を返せる。
- AC-004: ファイル選択時に実行/オープン、フォルダ選択時にオープンが行われる。
- AC-005: Rust テスト（unit/integration）が成功する。
- AC-006: GUI で検索・選択・実行/オープン・再読込が確認できる。

## Risks
- R-001: OS ごとのオープン/実行差異により挙動不一致が発生する。軽減策: 実行/オープン分岐を抽象化しテストで検証する。
- R-002: 大規模ディレクトリで走査コストが増大する。軽減策: FileList 優先、非同期処理、バッチ更新を維持する。

## Traceability (excerpt)
- FR-001 -> SP-001 -> DES-001 -> TC-001
- FR-002 -> SP-002 -> DES-002 -> TC-002
- FR-003 -> SP-003 -> DES-003 -> TC-003
- FR-004 -> SP-004 -> DES-004 -> TC-004
- FR-005 -> SP-005 -> DES-004 -> TC-005
- FR-006 -> SP-006 -> DES-005 -> TC-006
- FR-007 -> SP-010 -> DES-009 -> TC-010
- NFR-001 -> SP-007 -> DES-006 -> TC-007
- NFR-002 -> SP-008 -> DES-007 -> TC-008
- NFR-003 -> SP-009 -> DES-008 -> TC-009
- NFR-004 -> SP-011 -> DES-010 -> TC-011
