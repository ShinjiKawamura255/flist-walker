# AGENTS.md for FlistWalker

このファイルはプロジェクト固有のエージェント指示です。ワークスペース共通の方針と矛盾する場合は本ファイルを優先します。

## 1. 目的と範囲
- 目的: `fzf --walker` 相当の体験で、ファイル/フォルダを高速にファジー検索し、選択結果を実行またはオープンできる Rust ツールを開発する。
- スコープ In:
- Rust での本実装（GUI/CLI）
- `FileList.txt` / `filelist.txt` 優先読み込み（ルート直下のみ探索）
- File/Folder walker の分離
- fzf 互換クエリ（`'` 完全一致、`!` 除外、`^`/`$` の先頭末尾条件）
- 検索ハイライト、非マッチ非表示、複数選択と一括操作
- Windows 向けビルド運用（WSL から PowerShell 経由で Windows 側 Rust を実行）
- `docs/` の SDD + TDD 文書保守
- スコープ Out:
- 旧プロトタイプの機能追加
- ネットワークドライブ向け最適化
- 配布インストーラ作成

## 2. 現在の開発方針
- Rust 本実装を主軸に機能拡張と品質改善を行う。
- GUI/CLI の検索仕様・操作仕様の一貫性を維持する。
- Windows 実行を重視し、PowerShell から実行できるビルド/テスト導線を維持する。
- 旧プロトタイプ資産は `prototype/python/` に保管し、原則として Rust 側へ集約する。

## 3. UI 応答性ポリシー（最優先）
- 最優先要件: UI を固めない。重い I/O や計算は UI スレッドで実行しない。
- MUST: index/search/preview/create-filelist はワーカー（スレッド）で処理し、UI はイベント駆動で反映する。
- MUST: 検索・インデックス・ファイルリスト作成など長時間処理中でも、入力・カーソル移動・スクロール操作を維持する。
- MUST: 処理中ステータス（例: `Searching...`, `Indexing...`, `Creating FileList...`）を UI で可視化する。
- SHOULD: 増分反映やメッセージ処理は 1 フレームの予算を設け、再描画詰まりを防ぐ。
- SHOULD: プレビューは遅延してもよいが、一覧操作の滑らかさを優先する。

## 4. 重要な制約・品質特性
- 対応環境: Windows/macOS/Linux の主要 OS。
- 性能: 10万件候補で検索応答 100ms 未満を目標。
- 品質: TDD を基本とし、主要機能は unit test で保証する。
- セキュリティ: 外部コマンド実行は配列引数で呼び出し、シェル展開依存を避ける。
- 運用:
- Windows 向け Rust ビルドは `scripts/build-rust-win.sh` / `scripts/build-rust-win.ps1` を利用する。

## 5. 実装ガードレール
- FileList 検出仕様（大文字/小文字、優先順、探索範囲）を変更する場合は `indexer` テストを先に更新する。
- 非同期処理は request_id で最新応答のみ採用し、古い応答で UI 状態を巻き戻さない。
- GUI でパス種別判定やプレビュー生成などの同期 I/O を描画ループに持ち込まない。
- 仕様演算子（`'`, `!`, `^`, `$`）の検索契約は後方互換を維持する。

## 6. ドキュメント/プロセス
- `docs/` に `REQUIREMENTS.md` / `SPEC.md` / `DESIGN.md` / `TESTPLAN.md` を配置。
- ID は `FR-###` / `NFR-###` / `CON-###` / `SP-###` / `DES-###` / `TC-###` を付与。
- SPEC は MUST/SHOULD で規範化し、TDD を徹底する。
- 仕様や設計を変更したら、同一変更で docs の該当箇所も更新する。
- 変更時は最低限 `cargo test` を実行してから完了報告する。

## 7. トレース（抜粋）
- FR-### → SP-### → DES-### → TC-###
